package net.nitroservices.rezan.mlforandroidmalwaredetection;

import android.annotation.SuppressLint;
import android.content.ComponentName;
import android.content.Intent;
import android.net.VpnService;
import android.os.ParcelFileDescriptor;
import android.util.Log;

import com.mopeye.ConnChangeReceiver;

/**
 * Created by rezan on 11/4/16.
 */

public class PacketCaptureVPNService extends VpnService implements Runnable {


    private static final String TAG = "PacketCaptureVPNService";


    private Thread mThread;


    private Builder builder = new Builder();

    private ParcelFileDescriptor mInterface;


    public PacketCaptureVPNService() {

        builder = new Builder();

    }



    @SuppressLint({"NewApi"})
    private void createVPNInterface() {

        builder.setSession("PacketCapture");
        builder.addAddress("10.0.8.1", 32);
        builder.addRoute("0.0.0.0", 0);
        builder.setMtu(1500);
        builder.addDnsServer("8.8.8.8");
        builder.addDnsServer("4.2.2.1");


        Intent testIntent;

        mInterface = builder.establish();
        if (mInterface != null) {


            ComponentName componentName = new ComponentName(this, ConnChangeReceiver.class);
            getPackageManager().setComponentEnabledSetting(componentName, 1, 1);


        }



    }


    public void run() {

        try {

            createVPNInterface();

        } catch (Exception ex) {

            Log.e(TAG, "setupVpn() has expection:");
            Log.e(TAG, Log.getStackTraceString(ex));



        }



    }



}
